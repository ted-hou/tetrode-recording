files = { ...
    '\\research.files.med.harvard.edu\neurobio\NEUROBIOLOGY SHARED\Assad Lab\Lingfeng\Data\daisy17\daisy17_20230801\SpikeSort\tr_sorted_daisy17_20230801_230801_154516.mat', ...
    '\\research.files.med.harvard.edu\neurobio\NEUROBIOLOGY SHARED\Assad Lab\Lingfeng\Data\daisy17\daisy17_20230804\SpikeSort\tr_sorted_daisy17_20230804_230804_153713.mat', ...
    '\\research.files.med.harvard.edu\neurobio\NEUROBIOLOGY SHARED\Assad Lab\Lingfeng\Data\daisy18\daisy18_20230731\SpikeSort\tr_sorted_daisy18_20230731_230731_161918.mat', ...
    '\\research.files.med.harvard.edu\neurobio\NEUROBIOLOGY SHARED\Assad Lab\Lingfeng\Data\daisy18\daisy18_20230728\SpikeSort\tr_sorted_daisy18_20230728_230728_151933.mat', ...
    '\\research.files.med.harvard.edu\neurobio\NEUROBIOLOGY SHARED\Assad Lab\Lingfeng\Data\daisy18\daisy18_20230727\SpikeSort\tr_sorted_daisy18_20230727_230727_180050.mat', ...
    '\\research.files.med.harvard.edu\neurobio\NEUROBIOLOGY SHARED\Assad Lab\Lingfeng\Data\daisy18\daisy18_20230802\SpikeSort\tr_sorted_daisy18_20230802_230802_140526.mat', ...
    '\\research.files.med.harvard.edu\neurobio\NEUROBIOLOGY SHARED\Assad Lab\Lingfeng\Data\desmond31\desmond31_20230801\SpikeSort\tr_sorted_desmond31_20230801_230801_171746.mat', ...
    '\\research.files.med.harvard.edu\neurobio\NEUROBIOLOGY SHARED\Assad Lab\Lingfeng\Data\desmond31\desmond31_20230804\SpikeSort\tr_sorted_desmond31_20230804_230804_173252.mat' ...
    };

for iTr = 5:length(files)
    S = load(files{iTr});
    tr = S.tr;
    channels = [tr.Spikes.Channel];
    for iChn = channels
        refChn = max(tr.Spikes(iChn).Cluster.Classes);
        for iUnit = 1:refChn - 1
            hFigure = tr.PlotChannel(iChn, 'Reference', 'TRIAL_START', 'Event', 'PressOn', 'Exclude', '', 'Event2', '', 'Exclude2', '', ...
                'RasterXLim', [-4, 1], 'ExtendedWindow', [-0, 1], 'WaveformYLim', [-200, 200], 'PlotStim', false, 'Bins', 3, ...
                'Clusters', iUnit, 'ReferenceCluster', refChn, 'PrintMode', true, 'FontSize', 11);
            tr.GUISavePlot([], [], hFigure, Filename=['C:\SERVER\Figures\Spontaneous\', tr.GetExpName(), '_Chn', num2str(iChn), 'Unit', num2str(iUnit)], ...
                Reformat='RasterAndPETHAndWaveform')
            close all
        end
    end
    clear S tr
end